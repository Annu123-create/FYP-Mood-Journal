from flask import Flask, render_template_string, request, jsonify

app = Flask(__name__)

# Simple HTML template with your structure
HTML_TEMPLATE = """
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>GardenBot Chat</title>
  <style>
    body { font-family: Arial, sans-serif; background:#e8f5e9; text-align:center; }
    .container { width:400px; margin:50px auto; background:#4caf50; color:white; padding:20px; border-radius:10px; }
    #chatWindow { height:300px; overflow:auto; border:1px solid #fff; padding:5px; background:white; color:black; }
    input, button { padding:10px; margin:5px; border-radius:5px; }
    button { background:#2e7d32; color:white; border:none; cursor:pointer; }
    button:hover { background:#1b5e20; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Chat with GardenBot</h2>
    <div id="chatWindow"></div>
    <input type="text" id="userMessage" placeholder="Type your feelings...">
    <button onclick="sendMessage()">Send</button>
    <input type="text" id="globalSearch" placeholder="Search chatbot..." onkeyup="globalSearch(this.value)">
  </div>
  <script>
    function sendMessage(){
      const msg = document.getElementById('userMessage').value;
      if (!msg) return;
      const chat = document.getElementById('chatWindow');
      chat.innerHTML += `<p><b>You:</b> ${msg}</p>`;
      fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: msg })
      })
      .then(res => res.json())
      .then(data => {
        chat.innerHTML += `<p><b>Bot:</b> ${data.reply}</p>`;
        chat.scrollTop = chat.scrollHeight;
      });
      document.getElementById('userMessage').value = '';
    }

    function globalSearch(query){
      const chat = document.getElementById('chatWindow');
      if(query.trim()==="") return;
      chat.innerHTML += `<p><i>Searching for:</i> ${query}</p>`;
    }
  </script>
</body>
</html>
"""

@app.route('/')
def index():
    return render_template_string(HTML_TEMPLATE)

@app.route('/chat', methods=['POST'])
def chat():
    data = request.get_json()
    user_msg = data.get('message', '').lower()
    # Simple bot logic
    if "sad" in user_msg:
        reply = "I'm sorry you're feeling sad. Try stepping outside and enjoying some fresh air."
    elif "happy" in user_msg:
        reply = "That's wonderful! Keep spreading your joy."
    else:
        reply = "I'm here for you. Remember, deep breaths can help."
    return jsonify({'reply': reply})

if __name__ == '__main__':
    app.run(debug=True)
